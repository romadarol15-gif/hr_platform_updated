import os
import django
import random
from datetime import date, timedelta

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'hr_project.settings')
django.setup()

from django.contrib.auth.models import User
from hr.models import Task

print("üóëÔ∏è –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á...\n")
Task.objects.all().delete()
print("‚úì –í—Å–µ –∑–∞–¥–∞—á–∏ —É–¥–∞–ª–µ–Ω—ã\n")

print("‚ú® –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á...\n")

# –ü–æ–ª—É—á–∞–µ–º admin
admin = User.objects.get(username='admin')

# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∫—Ä–æ–º–µ admin
users = User.objects.exclude(username='admin').filter(is_active=True)

# –®–∞–±–ª–æ–Ω—ã –∑–∞–¥–∞—á –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç—è–º
task_templates = {
    '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫': [
        ('–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –º–æ–¥—É–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏', '–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –∏ —É–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å'),
        ('–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–≥–æ–≤ –≤ API', '–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫–∏ –≤ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã'),
        ('–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞', '–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π'),
        ('–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π', '–ü–æ–¥–Ω—è—Ç—å –≤–µ—Ä—Å–∏–∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å'),
        ('–ù–∞–ø–∏—Å–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é', '–°–æ—Å—Ç–∞–≤–∏—Ç—å README –∏ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é'),
        ('–ö–æ–¥-—Ä–µ–≤—å—é –ø—É–ª–ª-—Ä–µ–∫–≤–µ—Å—Ç–∞', '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–ª–ª–µ–≥–∏ –∏ –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏'),
    ],
    '–î–∏–∑–∞–π–Ω–µ—Ä': [
        ('–û–±–Ω–æ–≤–∏—Ç—å –¥–∏–∑–∞–π–Ω –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã', '–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–µ –º–æ–∫–∞–ø—ã –∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø—ã'),
        ('–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∏–∫–æ–Ω–∫–∏ –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è', '–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–±–æ—Ä –∏–∫–æ–Ω–æ–∫ –≤ –µ–¥–∏–Ω–æ–º —Å—Ç–∏–ª–µ'),
        ('–°–æ–∑–¥–∞—Ç—å UI-–∫–∏—Ç –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞', '–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤'),
        ('–ê–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∏–∑–∞–π–Ω –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ', '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö'),
    ],
    '–ë—É—Ö–≥–∞–ª—Ç–µ—Ä': [
        ('–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç', '–°–≤–µ—Å—Ç–∏ –≤—Å–µ —Ä–∞—Å—Ö–æ–¥—ã –∏ –¥–æ—Ö–æ–¥—ã'),
        ('–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞—è–≤–∫–∏ –Ω–∞ –æ—Ç–ø—É—Å–∫', '–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∏ –æ–¥–æ–±—Ä–∏—Ç—å –∑–∞—è–≤–∫–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤'),
        ('–†–∞—Å—á—ë—Ç –∑–∞—Ä–ø–ª–∞—Ç—ã –∑–∞ –º–µ—Å—è—Ü', '–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –≤–µ–¥–æ–º–æ—Å—Ç—å –Ω–∞ –≤—ã–ø–ª–∞—Ç—É'),
        ('–û—Ñ–æ—Ä–º–∏—Ç—å —Å–ø—Ä–∞–≤–∫–∏ 2-–ù–î–§–õ', '–°–æ—Å—Ç–∞–≤–∏—Ç—å —Å–ø—Ä–∞–≤–∫–∏ –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤'),
    ],
    '–ú–µ–Ω–µ–¥–∂–µ—Ä': [
        ('–ü—Ä–æ–≤–µ—Å—Ç–∏ –≤—Å—Ç—Ä–µ—á—É —Å –∫–ª–∏–µ–Ω—Ç–æ–º', '–û–±—Å—É–¥–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å—Ä–æ–∫–∏'),
        ('–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ', '–°–æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—é –∏ —Å–º–µ—Ç—É'),
        ('–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤', '–ò–∑—É—á–∏—Ç—å —Ä—ã–Ω–æ–∫ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ç—á—ë—Ç'),
        ('–°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –ø—Ä–æ–¥–∞–∂ –Ω–∞ –∫–≤–∞—Ä—Ç–∞–ª', '–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ü–µ–ª–∏ –∏ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏'),
    ],
    'default': [
        ('–ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Ç—á—ë—Ç –æ –ø—Ä–æ–¥–µ–ª–∞–Ω–Ω–æ–π —Ä–∞–±–æ—Ç–µ', '–°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –æ—Ç—á—ë—Ç –∑–∞ –Ω–µ–¥–µ–ª—é'),
        ('–û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é', '–í–Ω–µ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–∞–±–æ—á–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏'),
        ('–ü—Ä–æ–≤–µ—Å—Ç–∏ –≤—Å—Ç—Ä–µ—á—É —Å –∫–æ–º–∞–Ω–¥–æ–π', '–û–±—Å—É–¥–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏ –∏ –ø–ª–∞–Ω—ã'),
        ('–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—É—é –ø–æ—á—Ç—É', '–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞–∂–Ω—ã–µ –ø–∏—Å—å–º–∞'),
    ]
}

statuses = ['new', 'in_progress']
created_count = 0

for user in users:
    employee = getattr(user, 'employee_profile', None)
    if not employee:
        continue
    
    # –ù–∞—Ö–æ–¥–∏–º –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –∑–∞–¥–∞—á–∏ –ø–æ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏
    position = employee.position
    templates = task_templates.get(position, task_templates['default'])
    
    # –í—ã–±–∏—Ä–∞–µ–º 2 —Å–ª—É—á–∞–π–Ω—ã–µ –∑–∞–¥–∞—á–∏
    selected_tasks = random.sample(templates, min(2, len(templates)))
    
    for i, (title, description) in enumerate(selected_tasks):
        # –°–ª—É—á–∞–π–Ω–∞—è –¥–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è (7-14 –¥–Ω–µ–π)
        due_date = date.today() + timedelta(days=random.randint(7, 14))
        
        task = Task.objects.create(
            title=title,
            description=description,
            creator=admin,
            assignee=user,
            status=statuses[i],  # –ü–µ—Ä–≤–∞—è - –Ω–æ–≤–∞—è, –≤—Ç–æ—Ä–∞—è - –≤ —Ä–∞–±–æ—Ç–µ
            due_date=due_date
        )
        
        status_name = '–ù–æ–≤–∞—è' if task.status == 'new' else '–í —Ä–∞–±–æ—Ç–µ'
        print(f"‚úì {task.get_task_id()} - {user.username} ({employee.get_full_name()}): {title} [{status_name}]")
        created_count += 1

print(f"\n" + "="*60)
print(f"‚úÖ –°–æ–∑–¥–∞–Ω–æ –∑–∞–¥–∞—á: {created_count}")
print("="*60)
print("\n–î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª 'üìã –ó–∞–¥–∞—á–∏'\n")
