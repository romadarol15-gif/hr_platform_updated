{% extends "base.html" %}
{% block content %}
<div class="container">
<div class="welcome-section">
<h2>–ü—Ä–∏–≤–µ—Ç, {{ user.employee_profile.get_full_name|default:user.username }}!</h2>
<p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–ª–æ–º</p>
</div>
{% if employee %}
<div class="dashboard-grid">
<div class="dashboard-card">
<h3>‚è±Ô∏è –¢—Ä–µ–∫–µ—Ä —Ä–∞–±–æ—á–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏</h3>
{% if active_entry %}
<div class="tracker-active">
<p class="status-active">‚úì –¢—Ä–µ–∫–µ—Ä –∑–∞–ø—É—â–µ–Ω</p>
<p class="time-info">–ù–∞—á–∞–ª–æ: <strong>{{ active_entry.start_time|date:"H:i, d.m.Y" }}</strong></p>
<p class="time-worked">–û—Ç—Ä–∞–±–æ—Ç–∞–Ω–æ: <strong id="time-counter">{{ active_entry.get_duration }}</strong></p>
<form method="post" action="{% url 'hr:time_stop' %}">
{% csrf_token %}
<button type="submit" class="btn btn-danger">‚èπ –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
</form>
</div>
<script>
// –û–±–Ω–æ–≤–ª—è–µ–º —Å—á—ë—Ç—á–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
let startTime = new Date('{{ active_entry.start_time|date:"c" }}');
function updateTimer() {
    let now = new Date();
    let diff = now - startTime;
    let hours = Math.floor(diff / 3600000);
    let minutes = Math.floor((diff % 3600000) / 60000);
    let seconds = Math.floor((diff % 60000) / 1000);
    document.getElementById('time-counter').textContent = hours + '—á ' + minutes + '–º–∏–Ω ' + seconds + '—Å–µ–∫';
}
setInterval(updateTimer, 1000);
updateTimer();
</script>
{% else %}
<div class="tracker-inactive">
<p class="status-inactive">‚è∏ –¢—Ä–µ–∫–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω</p>
<form method="post" action="{% url 'hr:time_start' %}">
{% csrf_token %}
<button type="submit" class="btn btn-primary">‚ñ∂ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç—Ä–µ–∫–µ—Ä</button>
</form>
</div>
{% endif %}
</div>
<div class="dashboard-card">
<h3>üìã –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏</h3>
{% if tasks %}
<ul class="task-list-mini">
{% for task in tasks %}
<li>
<span class="badge badge-{{ task.status }}">{{ task.get_status_display }}</span>
{{ task.title }}
{% if task.due_date %}<small>(–¥–æ {{ task.due_date|date:"d.m.Y" }})</small>{% endif %}
</li>
{% endfor %}
</ul>
<a href="{% url 'hr:tasks' %}" class="btn btn-secondary btn-sm">üìÑ –í—Å–µ –∑–∞–¥–∞—á–∏</a>
{% else %}
<p>–ù–µ—Ç –Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á</p>
{% endif %}
</div>
</div>
{% endif %}
</div>
{% endblock %}