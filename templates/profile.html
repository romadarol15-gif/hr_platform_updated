{% extends "base.html" %}
{% block content %}
<div class="container">
<div class="profile-header">
<h2>
{% if viewing_own_profile %}–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å{% else %}–ü—Ä–æ—Ñ–∏–ª—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞{% endif %}
{% if not employee.user.is_active %}
<span class="badge badge-danger" style="margin-left: 1rem; background-color: #ef4444;">üö´ –ü—Ä–æ—Ñ–∏–ª—å –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω</span>
{% endif %}
</h2>
{% if not viewing_own_profile %}<p class="text-muted">–ü—Ä–æ—Å–º–æ—Ç—Ä: {{ employee.get_full_name }}</p>{% endif %}
</div>
<div class="profile-section">
<div class="profile-avatar-section">
{% if employee.avatar %}
<img src="{{ employee.avatar.url }}" alt="–ê–≤–∞—Ç–∞—Ä" class="profile-avatar">
{% else %}
<div class="profile-avatar-placeholder">
<span>{{ employee.first_name.0|default:"?" }}{{ employee.last_name.0|default:"" }}</span>
</div>
{% endif %}
<div class="profile-info-short">
<h3>{{ employee.get_full_name }}</h3>
<p class="position">{{ employee.position }}</p>
<p class="department">{{ employee.department }}</p>
<p class="employee-number">–¢–∞–±–µ–ª—å–Ω—ã–π ‚Ññ: <strong>{{ employee.user.username }}</strong></p>
{% if employee.email %}
<p class="employee-number">Email: <strong>{{ employee.email }}</strong></p>
{% endif %}
{% if employee.hire_date %}
<p class="employee-number">–î–∞—Ç–∞ –ø—Ä–∏—ë–º–∞: <strong>{{ employee.hire_date|date:"d.m.Y" }}</strong></p>
{% endif %}
</div>
</div>

{% if can_fire %}
<div class="fire-restore-section" style="margin-bottom: 2rem; padding: 1rem; background-color: #fef3c7; border-radius: 0.5rem; border-left: 4px solid #f59e0b;">
<h4 style="margin-bottom: 1rem;">‚ö†Ô∏è –î–µ–π—Å—Ç–≤–∏—è —Å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º</h4>
{% if employee.user.is_active %}
<form method="post" action="{% url 'hr:employee_fire' employee.id %}" style="display:inline;" onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–≤–æ–ª–∏—Ç—å —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?\n\n–ü–æ—Å–ª–µ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è:\n- –ü—Ä–æ—Ñ–∏–ª—å –±—É–¥–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–µ–Ω\n- –ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ Pass1234!!\n- –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ admin');">
{% csrf_token %}
<button type="submit" class="btn btn-danger">üö´ –£–≤–æ–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
</form>
<small class="form-text text-muted" style="margin-top: 0.5rem; display: block;">–ü–æ—Å–ª–µ —É–≤–æ–ª—å–Ω–µ–Ω–∏—è –ø—Ä–æ—Ñ–∏–ª—å —Å—Ç–∞–Ω–µ—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–º, –ø–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–∏—Ç—Å—è. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ admin.</small>
{% else %}
{% if user.is_superuser %}
<form method="post" action="{% url 'hr:employee_restore' employee.id %}" style="display:inline;" onsubmit="return confirm('–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —ç—Ç–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?\n\n–ü–∞—Ä–æ–ª—å –±—É–¥–µ—Ç —Å–±—Ä–æ—à–µ–Ω –Ω–∞: Pass1234!');">
{% csrf_token %}
<button type="submit" class="btn btn-success">‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
</form>
<small class="form-text text-muted" style="margin-top: 0.5rem; display: block;">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞. –ü–∞—Ä–æ–ª—å –±—É–¥–µ—Ç: Pass1234!</small>
{% else %}
<p class="text-muted">üö´ –°–æ—Ç—Ä—É–¥–Ω–∏–∫ —É–≤–æ–ª–µ–Ω. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–æ–∂–µ—Ç —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä.</p>
{% endif %}
{% endif %}
</div>
{% endif %}

<form method="post" class="profile-form" enctype="multipart/form-data">
{% csrf_token %}
<h3>–õ–∏—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h3>
<div class="form-grid">
<div class="form-group">
{{ form.last_name.label_tag }}
{{ form.last_name }}
</div>
<div class="form-group">
{{ form.first_name.label_tag }}
{{ form.first_name }}
</div>
<div class="form-group">
{{ form.middle_name.label_tag }}
{{ form.middle_name }}
</div>
</div>
<div class="form-grid">
<div class="form-group">
{{ form.email.label_tag }}
{{ form.email }}
</div>
<div class="form-group">
{{ form.phone.label_tag }}
{{ form.phone }}
</div>
<div class="form-group">
{{ form.avatar.label_tag }}
{{ form.avatar }}
{% if employee.avatar %}<p class="form-hint">–¢–µ–∫—É—â–∏–π: <a href="{{ employee.avatar.url }}" target="_blank">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å</a></p>{% endif %}
</div>
</div>
<h3>–î–æ–ª–∂–Ω–æ—Å—Ç—å –∏ —Å—Ç–∞—Ç—É—Å</h3>
<div class="form-grid">
<div class="form-group">
{{ form.role.label_tag }}
{{ form.role }}
</div>
<div class="form-group">
{{ form.position.label_tag }}
{{ form.position }}
</div>
<div class="form-group">
{{ form.department.label_tag }}
{{ form.department }}
</div>
<div class="form-group">
{{ form.status.label_tag }}
{{ form.status }}
</div>
</div>
{% if employee.hire_date %}
<div class="form-group">
{{ form.hire_date.label_tag }}
{{ form.hire_date }}
</div>
{% endif %}
<h3>–¶–µ–ª–∏ –∏ –æ–ø—ã—Ç</h3>
<div class="form-group">
{{ form.annual_goal.label_tag }}
{{ form.annual_goal }}
</div>
<div class="form-group">
<label>–û–ø—ã—Ç –≤–Ω—É—Ç—Ä–∏ –∫–æ–º–ø–∞–Ω–∏–∏</label>
<textarea class="form-control" rows="5" readonly style="background-color: #e9ecef;">{{ employee.get_work_experience }}</textarea>
<small class="form-text text-muted">–û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–µ–π</small>
</div>
<div class="form-group">
{{ form.external_experience.label_tag }}
{{ form.external_experience }}
</div>
{% if can_edit %}
<button type="submit" class="btn btn-primary">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
{% endif %}
</form>
</div>

<div class="education-section">
<div class="section-header">
<h3>üéì –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</h3>
{% if viewing_own_profile or can_edit %}
<a href="{% url 'hr:education_add' %}" class="btn btn-primary btn-sm">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</a>
{% endif %}
</div>
{% if educations %}
<div class="education-list">
{% for edu in educations %}
<div class="education-card">
<div class="education-header">
<h4>{{ edu.institution }}</h4>
<span class="badge badge-done">{{ edu.degree }}</span>
</div>
<p><strong>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</strong> {{ edu.field_of_study }}</p>
<p><strong>–ü–µ—Ä–∏–æ–¥:</strong> {{ edu.start_year }} - {% if edu.end_year %}{{ edu.end_year }}{% else %}–Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è{% endif %}</p>
{% if edu.description %}<p>{{ edu.description }}</p>{% endif %}
{% if edu.diploma_file %}
<p class="diploma-file">üìé <a href="{{ edu.diploma_file.url }}" target="_blank">–î–∏–ø–ª–æ–º/–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</a></p>
{% endif %}
{% if viewing_own_profile or can_edit %}
<div class="education-actions">
<a href="{% url 'hr:education_edit' edu.id %}" class="btn btn-secondary btn-sm">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
<form method="post" action="{% url 'hr:education_delete' edu.id %}" style="display:inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ?');">
{% csrf_token %}
<button type="submit" class="btn btn-danger btn-sm">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>
</div>
{% endif %}
</div>
{% endfor %}
</div>
{% else %}
<p class="text-muted">–û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–æ</p>
{% endif %}
</div>

<div class="education-section">
<div class="section-header">
<h3>üìÑ –î–æ–∫—É–º–µ–Ω—Ç—ã</h3>
{% if viewing_own_profile or can_edit %}
<a href="{% url 'hr:document_add' %}" class="btn btn-primary btn-sm">‚ûï –î–æ–±–∞–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç</a>
{% endif %}
</div>
{% if documents %}
<div class="education-list">
{% for doc in documents %}
<div class="education-card">
<div class="education-header">
<h4>{{ doc.name }}</h4>
<span class="badge badge-done">{{ doc.get_file_size_mb }} –ú–ë</span>
</div>
<p><strong>–î–∞—Ç–∞ –∑–∞–≥—Ä—É–∑–∫–∏:</strong> {{ doc.uploaded_at|date:"d.m.Y H:i" }}</p>
{% if doc.comment %}
<p><strong>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</strong> {{ doc.comment }}</p>
{% endif %}
<p class="diploma-file">üìé <a href="{{ doc.file.url }}" target="_blank" download>–°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª</a></p>
{% if viewing_own_profile or can_edit %}
<div class="education-actions">
<a href="{% url 'hr:document_edit' doc.id %}" class="btn btn-secondary btn-sm">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
<form method="post" action="{% url 'hr:document_delete' doc.id %}" style="display:inline;" onsubmit="return confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç?');">
{% csrf_token %}
<button type="submit" class="btn btn-danger btn-sm">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
</form>
</div>
{% endif %}
</div>
{% endfor %}
</div>
{% else %}
<p class="text-muted">–î–æ–∫—É–º–µ–Ω—Ç—ã –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>
{% endif %}
</div>

</div>
{% endblock %}