{% extends "base.html" %}
{% load calendar_filters %}
{% block content %}
<style>
.calendar-container {
    margin: 20px 0;
}
.calendar-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.calendar-table th {
    background: #6366f1;
    color: white;
    padding: 12px;
    text-align: center;
    font-weight: 600;
}
.calendar-table td {
    border: 1px solid #e5e7eb;
    padding: 8px;
    text-align: center;
    height: 80px;
    vertical-align: top;
    position: relative;
    cursor: pointer;
}
.calendar-table td:hover {
    background: #f9fafb;
}
.calendar-day {
    font-weight: 600;
    color: #374151;
}
.calendar-day.empty {
    color: #d1d5db;
}
.calendar-day.today {
    background: #6366f1;
    color: white;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
}
.work-indicator {
    margin-top: 4px;
    font-size: 11px;
    color: #059669;
    font-weight: 600;
}
.tooltip-content {
    display: none;
    position: absolute;
    background: #1f2937;
    color: white;
    padding: 12px;
    border-radius: 6px;
    font-size: 12px;
    z-index: 1000;
    min-width: 200px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    top: 100%;
    left: 50%;
    transform: translateX(-50%);
    margin-top: 5px;
}
.calendar-table td:hover .tooltip-content {
    display: block;
}
.session-entry {
    margin-bottom: 8px;
    padding: 6px;
    background: #374151;
    border-radius: 4px;
}
.session-time {
    font-weight: 600;
    color: #10b981;
}
.session-duration {
    color: #9ca3af;
    font-size: 10px;
}
.calendar-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    background: white;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.calendar-nav h4 {
    margin: 0;
    color: #374151;
}
.calendar-nav .btn {
    padding: 6px 12px;
}
</style>

<div class="container">
<div class="page-header">
<h2>üíº –†–∞–±–æ—Ç–∞</h2>
{% if can_create_employee %}
<a href="{% url 'hr:employee_create' %}" class="btn btn-success">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</a>
{% endif %}
</div>

<!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ç—Ä–µ–∫–µ—Ä–∞ –≤—Ä–µ–º–µ–Ω–∏ -->
{% if calendar_data %}
<div class="work-section">
<div class="calendar-nav">
<a href="?year={{ calendar_data.prev_year }}&month={{ calendar_data.prev_month }}" class="btn btn-sm btn-outline-primary">‚óÄ –ü—Ä–µ–¥—ã–¥—É—â–∏–π</a>
<h4>üìÖ {{ calendar_data.month_name }} {{ calendar_data.year }}</h4>
<a href="?year={{ calendar_data.next_year }}&month={{ calendar_data.next_month }}" class="btn btn-sm btn-outline-primary">–°–ª–µ–¥—É—é—â–∏–π ‚ñ∂</a>
</div>

<div class="calendar-container">
<table class="calendar-table">
<thead>
<tr>
<th>–ü–Ω</th>
<th>–í—Ç</th>
<th>–°—Ä</th>
<th>–ß—Ç</th>
<th>–ü—Ç</th>
<th>–°–±</th>
<th>–í—Å</th>
</tr>
</thead>
<tbody>
{% for week in calendar_data.weeks %}
<tr>
{% for day in week %}
<td>
{% if day != 0 %}
<div class="calendar-day {% if calendar_data.today.day == day and calendar_data.today.month == calendar_data.month and calendar_data.today.year == calendar_data.year %}today{% endif %}">
{{ day }}
</div>

{% if day in calendar_data.entries_by_date %}
{% with entries=calendar_data.entries_by_date|get_item:day %}
<div class="work-indicator">
‚úÖ {{ entries|length }} —Å–µ—Å—Å–∏{% if entries|length == 1 %}—è{% else %}–∏{% endif %}
</div>
<div class="tooltip-content">
<strong>üìÖ {{ day }} {{ calendar_data.month_name }}</strong><br>
{% for entry in entries %}
<div class="session-entry">
<div class="session-time">
üïí {{ entry.start_time|date:"H:i" }} - {% if entry.end_time %}{{ entry.end_time|date:"H:i" }}{% else %}–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ...{% endif %}
</div>
{% if entry.end_time %}
<div class="session-duration">‚è±Ô∏è {{ entry.get_duration }}</div>
{% endif %}
</div>
{% endfor %}
</div>
{% endwith %}
{% endif %}
{% else %}
<div class="calendar-day empty"> </div>
{% endif %}
</td>
{% endfor %}
</tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
{% endif %}

<div class="work-section">
<div class="section-header">
<h3>üìã –ú–æ–∏ –∑–∞—è–≤–∫–∏</h3>
<a href="{% url 'hr:work_request_create' %}" class="btn btn-primary btn-sm">‚ûï –°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É</a>
</div>
{% if requests %}
<div class="requests-list">
{% for request in requests %}
<div class="request-card">
<div class="request-header">
<strong>{{ request.get_request_type_display }}</strong>
<span class="badge {% if request.approved %}badge-done{% else %}badge-new{% endif %}">
{% if request.approved %}‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ{% else %}‚è≥ –ù–∞ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω–∏–∏{% endif %}
</span>
</div>
<p>{{ request.description }}</p>
<small>üìÖ {{ request.created_at|date:"d.m.Y H:i" }}</small>
{% if request.related_task %}
<p class="related-task"><small>üîó –°–≤—è–∑–∞–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∞: {{ request.related_task.get_task_id }} - {{ request.related_task.title }} ({{ request.related_task.get_status_display }})</small></p>
{% endif %}
</div>
{% endfor %}
</div>
{% else %}
<p>–ó–∞—è–≤–æ–∫ –Ω–µ—Ç</p>
{% endif %}
</div>
</div>
{% endblock %}